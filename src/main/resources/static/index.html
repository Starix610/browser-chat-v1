<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Starixçš„åœ¨çº¿èŠå¤©ç³»ç»Ÿ</title>
    <!--<link href="css/bootstrap.min.css" rel="stylesheet">-->
    <link href="css/zui.min.css" rel="stylesheet">
    <link href="css/main.css" rel="stylesheet">
    <link href="css/fy-alert.css" rel="stylesheet">
    <script src="js/jquery.js"></script>
    <!--<script src="js/bootstrap.min.js"></script>-->
    <script src="js/zui.min.js"></script>
    <script src="js/fy-alert.js"></script>
    <script src="js/app.js"></script>
    <script src="js/main.js"></script>

</head>
<body>

<div style="width: 1000px;margin: 0 auto;text-align: center">
    <h2>Starixçš„åœ¨çº¿èŠå¤©ç³»ç»Ÿ</h2>
    <hr>
    <div style="margin: 10px 10px">
        <span class="label label-badge label-success label-outline">ç”¨æˆ·å:<span id="username-label">åœ¨æ€è€ƒçš„ğŸ±</span></span>
        <span class="label label-badge label-success label-outline">ID:<span
                id="uid-label">1203555970559541250</span></span>
        <span class="label label-danger" style="cursor: pointer" id="exit">é€€å‡º</span>
    </div>
    <ul class="nav nav-primary nav-justified" style="margin-bottom: 10px">
        <li id="index" class="active"><a href="javascript:void(0);">ä¸»é¡µ</a></li>
        <li id="single-chat"><a href="javascript:void(0);">ä¸€å¯¹ä¸€å•èŠ</a></li>
        <li id="room-chat"><a href="javascript:void(0);">å¤šå¯¹å¤šèŠå¤©å®¤</a></li>
        <li id="call"><a href="javascript:void(0);">å‘¼å«</a></li>
    </ul>
</div>


<div class="panel panel-info" style="width: 1000px;margin: 0 auto" id="index-panel">
    <div class="panel-heading">
        <h3 class="panel-title">ä¸»é¡µ</h3>
    </div>
    <div class="panel-body" style="text-align: center">
        <div style="margin-bottom: 30px;margin-top: 10px">åœ¨çº¿ç”¨æˆ·åˆ—è¡¨</div>
        <table class="table table-hover table-fixed" style="text-align: left">
            <thead>
            <tr>
                <th>ç”¨æˆ·ID</th>
                <th>ç”¨æˆ·å</th>
                <th>ä¸Šçº¿æ—¶é—´</th>
                <th>æ“ä½œ</th>
            </tr>
            </thead>
            <tbody id="user-list">
            <!--<tr>-->
            <!--<td>484864864</td>-->
            <!--<td>å¸…é¸½</td>-->
            <!--<td>-->
            <!--<button class="btn btn-info" type="button">åŠ å¥½å‹</button>-->
            <!--</td>-->
            <!--</tr>-->
            </tbody>
        </table>
        <div style="text-align: center;margin-top: 20px;margin-bottom: 20px;color: red;display: none" id="no-user">
            æ²¡æœ‰åœ¨çº¿ç”¨æˆ·
        </div>
    </div>
</div>


<div class="panel panel-info" style="width: 1000px;margin: 0 auto;display: none" id="single-chat-panel">
    <div class="panel-heading">
        <h3 class="panel-title">ä¸€å¯¹ä¸€å•èŠ</h3>
    </div>

    <div class="panel-body" style="text-align: center">
        <span class="label" style="margin-left: 100px;" id="chat-title">å·¦ä¾§é€‰æ‹©ç”¨æˆ·è¿›è¡ŒèŠå¤©</span>
        <div style="text-align: left;margin-top: 5px;">
            <div class="list-group" style="width: 140px;color: red;float: left" id="chat-list">
                <!--<a href="#" class="list-group-item">-->
                <!--<h4 class="list-group-item-heading">å¸…é¸½</h4>-->
                <!--<p class="list-group-item-text text-muted">å…±12ä¸ªæ–°æ¡ç›®</p>-->
                <!--</a>-->
            </div>
            <div class="panel" style="float: left;width: 820px;margin-left: 8px; display: none">
                <div class="panel-body">
                    <div id="msgList" class="scrollbar-hover"
                         style="max-height: 500px; min-height: 500px; overflow: scroll;">
                        <!--<div class="panel panel-default" style="margin-bottom: 1px">-->
                        <!--<div class="panel-heading">2019/12/09 20:00:03 <b>å¸…é¸½</b>ï¼š</div>-->
                        <!--<div class="panel-body">-->
                        <!--æˆ‘æ¥äº†è€å¼Ÿ-->
                        <!--</div>-->
                        <!--</div>-->
                    </div>
                </div>
                <hr>
                <div class="row" style="margin-left: 6px;margin-bottom: 10px;">
                    <div class="col-xs-10">
                        <textarea class="form-control" rows="3" placeholder="è¾“å…¥è¦å‘é€çš„æ¶ˆæ¯" id="singleMsg"></textarea>
                    </div>
                    <div class="col-xs-2">
                        <button class="btn btn-success" style="width: 100px" type="button" id="send-single">å‘é€</button>
                    </div>
                </div>
            </div>

        </div>
    </div>

</div>


<div class="panel panel-info" style="width: 1000px;margin: 0 auto;display: none" id="room-chat-panel">
    <div class="panel-heading">
        <h3 class="panel-title">å¤šå¯¹å¤šèŠå¤©å®¤</h3>
    </div>
    <div class="panel-body" style="text-align: center">
        <span class="label">å…¬å…±èŠå¤©å®¤</span>
        <div class="panel" style="margin-top: 5px; text-align: left">
            <div class="panel-body">
                <div id="roomMsgList" class="scrollbar-hover"
                     style="max-height: 500px; min-height: 500px; overflow: scroll;">
                    <!--<div class="panel panel-default" style="margin-bottom: 1px">-->
                    <!--<div class="panel-heading">2019/12/09 20:00:03 <b>å¸…é¸½</b>ï¼š</div>-->
                    <!--<div class="panel-body">-->
                    <!--æˆ‘æ¥äº†è€å¼Ÿ-->
                    <!--</div>-->
                    <!--</div>-->
                </div>
            </div>
        </div>
        <hr>
        <div class="row" style="margin-left: 6px;margin-bottom: 10px;">
            <div class="col-xs-10">
                <textarea class="form-control" rows="3" placeholder="è¾“å…¥è¦å‘é€çš„æ¶ˆæ¯" id="roomMsg"></textarea>
            </div>
            <div class="col-xs-2">
                <button class="btn btn-success" style="width: 100px" type="button" id="send-room">å‘é€</button>
            </div>
        </div>
    </div>
</div>


<div class="panel panel-info" style="width: 1000px;margin: 0 auto;display: none" id="call-panel">
    <div class="panel-heading">
        <h3 class="panel-title">å‘¼å«ç”¨æˆ·</h3>
    </div>
    <div class="panel-body">
        <div style="width: 500px;margin: 10px auto;">
            <div class="row">
                <div class="col-xs-10">
                    <div class="input-control search-box has-icon-left has-icon-right has-warning" id="search-box">
                        <input id="search-input" type="search" class="form-control search-input" placeholder="æœç´¢ç”¨æˆ·">
                        <label for="search-input" class="input-control-icon-left search-icon"><i class="icon icon-search"></i></label>
                        <a href="#" class="input-control-icon-right search-clear-btn"><i class="icon icon-remove"></i></a>
                    </div>
                </div>
                <div class="col-xs-2">
                    <button class="btn btn-success" style="width: 100px" type="button" id="search">ç¡®å®š</button>
                </div>
            </div>
        </div>
        <hr>
        <table id="search-table" class="table table-hover table-fixed" style="text-align: left;display: none">
            <thead>
            <tr>
                <th>ç”¨æˆ·ID</th>
                <th>ç”¨æˆ·å</th>
                <th>ä¸Šçº¿æ—¶é—´</th>
                <th>çŠ¶æ€</th>
                <th>æ“ä½œ</th>
            </tr>
            </thead>
            <tbody id="search-list">
            <!--<tr>-->
                <!--<td>484864864</td>-->
                <!--<td>å¸…é¸½</td>-->
                <!--<td>2019/12/11 15:01:03</td>-->
                <!--<td>åœ¨çº¿</td>-->
                <!--<td>-->
                    <!--<button class="btn btn-info" type="button" id="">å‘¼å«</button>-->
                <!--</td>-->
            <!--</tr>-->
            </tbody>
        </table>
        <div style="text-align: center;margin-top: 20px;margin-bottom: 10px;color: red;display: none;" id="no-result">
            æœªæ‰¾åˆ°ç›¸å…³ç”¨æˆ·
        </div>

    </div>
</div>

</div>


<script content="text/javascript">

    $(function () {
        getUserInfo();
        websocketInit();
        websocketHandler();
        loadUserList();
        loadUserChatList();
    })

    var socket;

    function websocketInit() {
        if (typeof(WebSocket) == "undefined") {
            console.log("æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒWebSocket");
        } else {
            //å®ç°åŒ–WebSocketå¯¹è±¡ï¼ŒæŒ‡å®šè¦è¿æ¥çš„æœåŠ¡å™¨åœ°å€ä¸ç«¯å£  å»ºç«‹è¿æ¥
            socket = new WebSocket(app.BASE_WS_URL + "/websocket/" + localStorage.getItem("uid"));
        }

    }

    function websocketHandler() {
        //è¿æ¥æ‰“å¼€äº‹ä»¶
        socket.onopen = function () {
            console.log("Socket å·²æ‰“å¼€");
        };
        //è·å¾—æ¶ˆæ¯äº‹ä»¶
        socket.onmessage = function (msg) {
            console.log(msg.data);
            //æ”¶åˆ°æœåŠ¡ç«¯æ¶ˆæ¯ï¼Œå¼€å§‹å¤„ç†å‰ç«¯è§¦å‘é€»è¾‘
            handlerMsg(msg.data)
        };
        //è¿æ¥å…³é—­äº‹ä»¶
        socket.onclose = function () {
            console.log("WebSocketå·²å…³é—­");
        };
        //å‘ç”Ÿé”™è¯¯äº‹ä»¶
        socket.onerror = function () {
            alert("WebSocketå‘ç”Ÿäº†é”™è¯¯");
            //æ­¤æ—¶å¯ä»¥å°è¯•åˆ·æ–°é¡µé¢
        }
        //ç¦»å¼€é¡µé¢æ—¶ï¼Œå…³é—­socket
        //jquery1.8ä¸­å·²ç»è¢«åºŸå¼ƒï¼Œ3.0ä¸­å·²ç»ç§»é™¤
        // $(window).unload(function(){
        //     socket.close();
        //});
    }


    //å¤„ç†æ¥æ”¶åˆ°çš„æ¶ˆæ¯
    function handlerMsg(msgData) {
        msgData = JSON.parse(msgData);
        if (msgData.type == app.SINGLE) {
            handlerSingleMsg(msgData);
        }

        if (msgData.type == app.ROOM) {
            handlerRoomMsg(msgData);
        }

        if (msgData.type == app.STATUS_CHANGE) {
            loadUserList();
            show_info_box(msgData.content);
        }

        if (msgData.type == app.CALL){
            handlerCall(msgData);
        }

        if (msgData.type == app.CALL_REPLY){
            handlerCallReply(msgData);
        }
    }

</script>
</body>
</html>